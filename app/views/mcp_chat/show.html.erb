<% odd = false %>

<div class="width: 96vw; height: 90vh; position: relative; margin-top: 20px; padding-top: 30px; font-size: 1.25em;">
  <br /><%= link_to "Start new chat", '/mcp_chat/new', style: "background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 3px; margin-top: 30px; cursor: pointer;" %>

  <div style="width: 96vw; margin-top: 20px;">
    <% @mcp_chat.ui_messages.each do |message| %>
      <% odd = !odd %>
      <% background = odd ? "#FFF" : "#f3f3f3" %>
      <div class="message <%= message["role"] %>" style="background-color: <%= background %>; padding: 10px;">
        <strong><%= message["role"].capitalize %>:</strong>
        <span><%= simple_format message["content"] %></span>
      </div>
    <% end %>
  </div>

  <% if @mcp_chat.pending_tool_confirmation? %>
    <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; margin: 20px 0; border-radius: 5px;">
      <h3>Can I perform the following action?</h3>
      <% tool_call = @mcp_chat.pending_tool_call %>
      <p><strong>Function:</strong> <%= tool_call.dig("function", "name") %></p>
      <p><strong>Arguments:</strong></p>
      <pre style="background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto;"><%= JSON.pretty_generate(JSON.parse(tool_call.dig("function", "arguments"))) %></pre>

      <div style="margin-top: 15px;">
        <%= form_with url: '/mcp_chat/confirm_tool_yes', html: { style: "display: inline-block;" }, method: :post do |form| %>
          <%= form.submit "YES", style: "background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 3px; margin-right: 10px; cursor: pointer;" %>
        <% end %>

        <%= form_with url: '/mcp_chat/confirm_tool_no', html: { style: "display: inline-block;" }, method: :post do |form| %>
          <%= form.submit "NO", style: "background-color: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 3px; cursor: pointer;" %>
        <% end %>
      </div>
    </div>
  <% else %>
    <div style="width: 70vw; margin-top: 20px; margin-bottom: 20px;">
      <%= form_with url: '/mcp_chat/chat', method: :post do |form| %>
        <div>
          <%= form.text_area :prompt, rows: 5, cols: 60, placeholder: "", style: 'width: 100%; padding: 10px;' %>
        </div>
        <div>
          <%= form.submit "Send", style: "background-color: #4285f4; color: white; border: none; padding: 8px 15px; border-radius: 3px; cursor: pointer;" %> &nbsp; Chat id: <%= @mcp_chat.mcp_chat_id %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
